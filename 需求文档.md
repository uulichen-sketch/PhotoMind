# 照片管理工具 - 需求文档

**项目名称：** PhotoMind（智能照片管理助手）
**创建时间：** 2026-02-14
**目标用户：** 摄影爱好者（老年人友好）

---

## 一、项目背景

为摄影爱好者打造一个本地化的智能照片管理系统，支持语音搜索、智能分类、详细信息展示，特别注重老年用户的使用体验。

---

## 二、核心功能

### 2.1 语音搜索
- **输入方式：** Web 页面语音输入（按住说话）
- **识别方案：** sherpa-onnx 本地 ASR（无需联网）
- **搜索逻辑：** 语义理解 → 向量检索 → 返回匹配照片
- **示例：** "去年夏天在海边拍的照片" → 返回相关照片

### 2.2 照片展示
- **网格视图：** 大缩略图，方便浏览
- **详情视图：** 展示完整信息
- **老年友好：**
  - 默认字体 18px，可调至 24px
  - 高对比度配色
  - 大按钮、大点击区域
  - 简洁界面，减少干扰

### 2.3 照片信息
- **基础信息：** 文件名、大小、格式
- **EXIF 信息：** 
  - 拍摄时间（格式化为"2025年7月15日 下午3:20"）
  - GPS 位置（转为中文地名，如"山东省青岛市"）
  - 相机型号（如"Canon EOS R5"）
  - 镜头信息（如"RF 24-70mm f/2.8"）
  - 拍摄参数（ISO、光圈、快门、焦距）
- **AI 信息：**
  - 照片描述（GLM-4V 生成，如"夕阳下的海滩，有人在散步"）
  - 分类标签（如"风景"、"海边"、"日落"）

### 2.4 批量导入
- **工作流：**
  1. 选择文件夹
  2. 扫描照片（支持 jpg, png, heic, raw）
  3. 提取 EXIF 信息
  4. 调用 GLM-4V 识别内容
  5. 生成描述 + 标签
  6. 向量化并存入 ChromaDB
  7. 显示导入进度
- **增量导入：** 只处理新增照片，避免重复

---

## 三、技术架构

### 3.1 前端
- **框架：** Vue 3 + Vite
- **UI 库：** Element Plus（老年友好主题）
- **语音：** Web Audio API + 录音组件
- **特色：** 响应式布局、语音交互

### 3.2 后端
- **框架：** FastAPI (Python 3.10+)
- **语音识别：** sherpa-onnx（本地）
- **图像识别：** GLM-4V API（智谱）
- **向量数据库：** ChromaDB（本地持久化）
- **EXIF 提取：** Pillow + exifread

### 3.3 部署
- **方式：** Docker Compose
- **一键启动：** `docker-compose up -d`
- **本地运行：** 所有数据本地存储

---

## 四、数据结构

### 4.1 照片元数据（存储在 ChromaDB）
```json
{
  "id": "photo_001",
  "file_path": "/photos/2025/07/beach_001.jpg",
  "filename": "beach_001.jpg",
  "datetime": "2025-07-15T15:20:00",
  "location": "山东省青岛市金沙滩",
  "camera": "Canon EOS R5",
  "lens": "RF 24-70mm f/2.8L IS USM",
  "iso": 400,
  "aperture": "f/8",
  "shutter": "1/500s",
  "focal_length": "35mm",
  "description": "夕阳下的金沙滩，海浪轻柔地拍打着岸边，有几个人在散步",
  "tags": ["风景", "海边", "日落", "夏天"],
  "embedding": [0.123, 0.456, ...]  // 向量
}
```

### 4.2 向量嵌入
- **模型：** text2vec-base-chinese（本地运行）
- **维度：** 768
- **存储：** ChromaDB collection

---

## 五、API 接口设计

### 5.1 语音搜索
```
POST /api/search/voice
Request: { "audio": "base64 encoded audio" }
Response: {
  "text": "去年夏天在海边拍的照片",
  "photos": [
    { "id": "...", "thumbnail": "...", "description": "..." },
    ...
  ]
}
```

### 5.2 文字搜索
```
POST /api/search/text
Request: { "query": "去年夏天在海边拍的照片" }
Response: { "photos": [...] }
```

### 5.3 批量导入
```
POST /api/import/start
Request: { "folder_path": "/path/to/photos" }
Response: { "task_id": "import_001" }

GET /api/import/status/{task_id}
Response: { 
  "status": "processing", 
  "total": 1000, 
  "processed": 150,
  "current_file": "IMG_0150.jpg"
}
```

### 5.4 获取照片详情
```
GET /api/photo/{photo_id}
Response: { ...full metadata... }
```

---

## 六、开发计划

### Phase 1：基础架构（1-2 天）
- [ ] 项目结构搭建
- [ ] Docker 配置
- [ ] 后端 API 框架
- [ ] 前端项目初始化

### Phase 2：核心功能（2-3 天）
- [ ] EXIF 提取
- [ ] GLM-4V 图像识别
- [ ] ChromaDB 集成
- [ ] 批量导入流程

### Phase 3：语音搜索（1-2 天）
- [ ] sherpa-onnx 集成
- [ ] 语音录制组件
- [ ] 搜索逻辑实现

### Phase 4：UI 优化（1-2 天）
- [ ] 老年友好主题
- [ ] 响应式布局
- [ ] 交互优化

### Phase 5：测试 & 部署（1 天）
- [ ] 功能测试
- [ ] 部署文档
- [ ] 使用说明

---

## 七、约束条件

1. **本地运行：** 所有数据不上云，保护隐私
2. **易于部署：** 一键 Docker 启动，无需配置
3. **性能要求：** 搜索响应 < 2 秒，导入支持增量
4. **兼容性：** 支持 Windows/Mac/Linux

---

## 八、后续扩展

- [ ] 人脸识别 & 人物标签
- [ ] 照片编辑（裁剪、滤镜）
- [ ] 照片分享（生成链接）
- [ ] 移动端适配
- [ ] 多语言支持
